phmisk
======

Phmisk is a Php/Html5 MIcro Starter Kit.
It comes with an **html5 UI**: Html5boilerplate and Twitter Bootstrap, from [Initializr](http://www.initializr.com).
Phmisk is ready to work with:
* a router: [bramus/router](https://github.com/bramus/router)
* a template engine: [rain.TPL](http://www.raintpl.com/)
* an ORM database layer: [VoodOrm](https://github.com/mardix/VoodOrm)

Phmisk comes out *without these libraries*, so you have to use Composer to install them.
Of course, using Composer you can include and use also other libraries.

***

Installation
------------

1. download and install [Composer](https://getcomposer.org/doc/00-intro.md#installation-nix) on your machine
2. clone/download this repository
3. go to phmisk directory and launch Composer install to resolve and download required packages:  

   if Composer local installation:  
   ```  
   $ php composer.phar install  
   ```  
   if Composer global installation:  

   ```  
   $ composer install  
   ```  
4. set the permission of `app/cache` folder to 777
5. edit the configuration in `app/config.php`
6. edit the main `index.php`

***

Routes
------

### Routing

Add the simplest route in main `index.php`:
```php
$router->get('/hello', function() {
	
	echo 'Hello world!';
	
});
```
And you can visit `your-site.com/hello` to see it.

### Custom controller files

You can map custom controller/method as a route: put your controllers inside `app\controllers` and they will be autoloded. Then, you have to add a route statement in main `index.php`: here is a route provided by custom controller called `Demo`:
```php
$demo = new App\Controllers\Demo();

$router->get('/test', function() use ( $demo ) {
	
	$demo->test();
});
```

The `Demo` controller file is located in `app\controllers\Demo.php` and contains something like:
```php
namespace App\Controllers;

class Demo extends Base
{	
	function test() 
	{
		echo 'This page has been created by Test method of Demo custom controller';			
	}

}
```
The `Base` controller is a parent class you can extend to have shared methods.

### Reference

For usage and more examples (Dynamic Route Patterns, Mounting Routes...) please see the [router homepage: bramus/router](https://github.com/bramus/router.)

***
Templates
---------
To use the template engine in a route add `use ($tpl)` to the function. A route in `index.php` could be:
```php
$router->get('/hello/(\w+)', function($name) use ( $tpl ) {
	
	$tpl->assign( 'name', $name );
	$tpl->draw( 'hello' );
	
});
```
The template file, `ui/hello.php`, could be:
```html
{include="header"}

	<div class="container">
		<div class="page-header">
		
			<h1>Hi {$name}</h1>
			
		</div>
		<p class="lead">You are welcome!</p>
	</div>

{include="footer"}
```
You can visit `your-site.com/hello/johnny` to see it.

Note that template files are php files, so you can freely use php statements.

### Reference

For usage and more examples please see the [template engine homepage: rain.TPL](http://www.raintpl.com).

***
ORM database layer
------------------

Phmisk uses an ORM library built on top of [PDO](http://www.php.net/manual/en/book.pdo.php).

In this `blog` route you get some posts and prepare them to be sent to layout: 
```php
$router->get('/blog', function() use ( $db, $tpl ) {

	$results = $db->table('posts')->limit(5)->find();

	$posts = array();
	if ( $results ) foreach ($results as $item) $posts[] = array('title' => $item->title );
	
	$data = array(
		'msg' 		=> 'My posts',
		'posts'		=> $posts,
	);
	
	$tpl->assign( $data );	
	$tpl->draw( 'blog' );    
});
```
Note that you have to add `use ( $db )` to the function in order to pass the ORM instance.
The database connection parameters are set in `app/config.php` and the connection starts in `app/bootstrap.php`.

Just for your thirst for knowledge, here is the blog template file, `ui/blog.php`:
```html
{include="header"}

	<div class="container">
	
		<div class="page-header">
			<h1>{$msg}</h1>
		</div>
		
		<ul class="lead">
			{loop="$posts"}
				<li>{$value.title}</li>
			{else}
				<li>No post yet.</li>
			{/loop}
		</ul>
	</div>

{include="footer"}
```

### Reference

For usage and more examples please see the [ORM homepage: VoodOrm](https://github.com/mardix/VoodOrm).


***
The file structure
------------------

```
phmisk root/
  |
  |__ app/
  |      |__ cache/
  |      |__ controllers/  
  |      |  
  |      |__ bootstrap.php
  |      |__ config.php
  |      |__ helpers.php  
  |
  |__ ui/
  |      |__ css/
  |      |__ fonts/  
  |      |__ img/  
  |      |__ js/    
  |      |
  |      |__ (php view files)  
  |
  |__ composer.json
  |__ index.php
  |__ .htaccess  
```

The `app/cache` folder contains the files generated by the template engine (note: *cache folder must have permissions to 777*).
The `app/controllers` folder contains all your custom controllers and a `Base` controller.

The `ui` contains all the Html5boilerplate and Twitter Bootstrap folder and files, generated using [Initializr](http://www.initializr.com/) and edited to work in Phmisk. Then, there are some php view files: header, home, footer...

Phmisk comes out **without libraries** (router, template, ORM). You have to use Composer to install them. After that a new `vendor` folder will appear. 

The `app` folder contains some important files: 
* `config.php`: here you can set database parameters and other settings;
* `bootstrap.php`: the main classes (router, template, database and ORM) are initialised here;
* `helpers.php`: this file contains some useful functions you can use everywhere.


***
Include more packages
---------------------

To include more packages you can simply add them in `require` section inside `composer.json` and then launch Composer update:
```
	"require": {
		...
		"monolog/monolog": "1.0.*"
	},
```

If you like to use other packages instead of standard (e.g. another template engine), you have to set them in `require` section inside `composer.json`, then change the initialisation in `bootstrap.php`.


***
Quick tutorial: create a form with PFBC
---------------------------------------

Here is a quick tutorial to include a ready-to-use form with [PHP Form Builder Class](https://github.com/lkorth/php-form-builder-class).

Add the package in `require` section inside `composer.json`:
```
	"require": {
		...
		"pfbc/pfbc": "3.1"
	},
```

Launch the Composer install o update:
```  
$ composer install 
```  
or

```  
$ composer update
```  

Add these routes in main `index.php`:
```php
$router->mount('/form', function() use ($router, $tpl) {

	// Init the form
	session_start();
	
	$form = new PFBC\Form("first-form");
	$form->configure(array(
		"prevent" => array("bootstrap", "jQuery"),
		"action" => BASE_URL.'form' 
	));
	
	$form->addElement(new PFBC\Element\Textbox("My Textbox:", "MyTextbox"));
	$form->addElement(new PFBC\Element\Select("My Select:", "MySelect", array(
		"" => 'Select',
	   "Option #1",
	   "Option #2",
	   "Option #3"
	), array(
		"required" => 1,
	)));
	$form->addElement(new PFBC\Element\Button);
	
	
    // Show the form
    $router->get('/', function() use ($form, $tpl) {
		$data = array(
			'msg' 		=> 'Please fill in the form',
			'form'		=> $form->render( true ),
		);
		
		$tpl->assign( $data );	
		$tpl->draw( 'form' );    
    });


	// Check submitted form
    $router->post('/', function() use ($form, $tpl) {	
		
		if( PFBC\Form::isValid("first-form") )
		{
			$form->clearErrors("first-form");
			redirect('form/thankyou');
		}
		else
		{
			redirect('form');
		}
		
	});

	// Show result
	$router->get('/thankyou', function() use ($form, $tpl) {
		
		$data = array(
			'msg' 		=> 'Thank you!',
			'text'		=> 'Your data is important for us.',
		);
		
		$tpl->assign( $data );
		$tpl->draw( 'message' );  
	});
	
});
```

Then, here is the form template, `ui/form.php`:

```html
{include="header"}

	<div class="container">
		<div class="page-header">
			<h1><span class="glyphicon {$glyphicon? $glyphicon :'glyphicon-asterisk'}"></span> {$msg}</h1>
		</div>
		
		<?php echo $form ?>
	</div>

{include="footer"}
```

And the message template, `ui/message.php`:
```html
{include="header"}

	<div class="container">
		<div class="page-header">
			<h1><span class="glyphicon {$glyphicon? $glyphicon :'glyphicon-asterisk'}"></span> {$msg}</h1>
		</div>
		<p class="lead">{$text}</p>
	</div>

{include="footer"}
```
